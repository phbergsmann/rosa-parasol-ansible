---

### Debug outputs and prerequisites checks

- name: Run oc cluster-info
  ansible.builtin.command: oc cluster-info
  register: oc_cluster_info
  changed_when: false
  failed_when: false

- name: Show oc cluster-info output
  ansible.builtin.debug:
    msg: "{{ oc_cluster_info.stdout | default('oc not found or command failed') }}"

- name: Run aws sts get-caller-identity
  ansible.builtin.command: aws sts get-caller-identity
  register: aws_caller_identity
  changed_when: false
  failed_when: false

- name: Show AWS STS caller identity
  ansible.builtin.debug:
    msg: "{{ aws_caller_identity.stdout | default('aws CLI not found or command failed') }}"

### Main tasks

- name: Fetch OIDC provider information
  import_tasks: fetch_oidc.yml

- name: Create IAM roles and attach policies
  import_tasks: iam_roles.yml

- name: Create ConfigMap for Bedrock
  import_tasks: create_configmap.yml

- name: Create ServiceAccount for Bedrock
  import_tasks: create_serviceaccount.yml
